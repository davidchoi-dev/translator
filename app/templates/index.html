{% extends "base.html" %}
{% block content %}
  <div id="fb-root"></div>

  <p>{{ _("app-description-html") }}</p>

  {% if is_msie %}
  <div class="alert">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    {{ _("Better Translator may not work properly with Internet Explorer 9 and below. We encourage you to try modern browsers such as Firefox, Chrome and Safari.") }}
  </div>
  {% endif %}

  <div class="alert">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    "Our systems have detected unusual traffic from your computer network."
    오류 메세지가 뜬다면 전용 클라이언트를 이용해보세요.
    &lt;<a href="/download-clients">바로가기</a>&gt;
  </div>

  <p id="google-translate">
    <img src="/static/google_translate.jpg" alt="구글 번역기를 사용할 때에는 바로 다른 언어로 번역하는것 보다 일본어로 한 번 번역한 다음에 다른 언어로 바꾸는게 더 정확합니다. 전 세계에서 일본 동인지를 번역 하다 보니 수많은 데이터베이스가 쌓였거든요" />
  </p>

  <form id="translation-form" method="get" onsubmit="return performTranslation()">
    <div class="row-fluid">
      <div class="span3">
        <label>{{ _("Source Language") }}</label>
        <select name="sl">
          <option value="auto">{{ _("Detect language" ) }}</option>
          {{ language_options | safe }}
        </select>
      </div>
      <div class="span3">
        <label>{{ _("Intermediate Language") }}</label>
        <select name="il">
          <option value="">{{ _("None") }}</option>
          <option value="ja">{{ _("Japanese") }}</option>
          <option value="ru">{{ _("Russian") }}</option>
        </select>
      </div>

      <div class="span3">
        <label>{{ _("Target Language") }}</label>
        <select name="tl">
            {{ language_options | safe }}
        </select>
      </div>

      <div class="span3" style="text-align:right;">
        <label>&nbsp;</label>
        <button class="btn" onclick="swapLanguages()"
          data-toggle="tooltip" data-placement="top"
          title="{{ _('Swap languages') }}">
          <img src="/static/swap.png" alt="{{ _("Swap languages") }}"/>
        </button>
        <button class="btn btn-primary translate">{{ _("Translate") }}</button>
      </div>

    </div>
    <div class="row-fluid" style="margin-top:1em;">
      <div class="span6">

        <textarea id="source-text" name="t" placeholder="{{ _('Type in your sentences') }}"></textarea>

        <div id="search-results" class="hide">
          {{ _("Similar translations") }}
          <ul></ul>
        </div>
      </div>
      <div class="span6">

        <div id="error-message" class="alert alert-error"></div>
        <div>
          <div id="progress-message" style="float:left;">
            {{ _("Translation in progress...") }} <img src="/static/progress.gif"/>
          </div>
          <pre id="target-text"></pre>
        </div>

      </div>
    </div>
  </form>

  <div id="captcha-dialog" class="modal hide fade">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Opps...</h3>
    </div>
    <div class="modal-body">
    </div>
    <div class="modal-footer">
      <a href="#" class="btn" data-dismiss="modal">{{ _("Close") }}</a>
    </div>
  </div>


<!--
This section is reserved for gettext string extraction purposes
FIXME: There must be a better way than this
{{ _('Russian') }}
{{ _('French') }}
{{ _('English') }}
{{ _('Portuguese') }}
{{ _('Vietnamese') }}
{{ _('German') }}
{{ _('Korean') }}
{{ _('Italian') }}
{{ _('Hebrew') }}
{{ _('Indonesian') }}
{{ _('Turkish') }}
{{ _('Chinese') }}
{{ _('Filipino') }}
{{ _('Arabic') }}
{{ _('Polish') }}
{{ _('Thai') }}
{{ _('Czech') }}
{{ _('Swedish') }}
{{ _('Japanese') }}
{{ _('Spanish') }}
-->

<!--<script type="text/javascript" src="/static/jquery.succinct.js"></script>-->
<script type="text/javascript">
{% if translation %}state.initWithTranslation({{ translation | safe }}); {% endif %}

var locale = '{{ locale }}';

window.onload = function() {

    // The following code was copied from
    // http://stackoverflow.com/questions/2161906/handle-url-anchor-change-event-in-js
    if ("onhashchange" in window) { // event supported?
        window.onhashchange = function () {
            hashChanged(window.location.hash);
        };
    }
    else { // event not supported:
        var storedHash = window.location.hash;
        window.setInterval(function () {
            if (window.location.hash != storedHash) {
                storedHash = window.location.hash;
                hashChanged(storedHash);
            }
        }, 250);
    }

    if (state.id) {
        //askForRating(state.requestId);
    }
    else {
        if (getParameterByName("t")) {
            state.initWithParameters();
            performTranslation();
        }
        else {
            state.init();

            hashChanged(window.location.hash ? window.location.hash : "");
        }
    }

    $("#source-text, #target-text").autoResize({
        // On resize:
        onResize: function() {
            $(this).css({opacity:0.8});
        },
        // After resize:
        animateCallback: function() {
            $(this).css({opacity:1});
        },
        // Quite slow animation:
        animateDuration: 300,
        // More extra space:
        extraSpace: 40
    })
    .keypress(function (event) {
        if (event.keyCode == 13) {
            performTranslation();
        }
    })
    .trigger("change");

    // Dynamically set the available languages
    var lurl = sprintf('/api/v1.3/languages?locale=%s&field=source', locale);
    $.get(lurl, function(response) {
      var languages = $.map(response.languages, function(pair) {
        return {label: pair[1], value: pair[0]};
      });
      var sl = $.cookie('sourceLanguage');
      var tl = $.cookie('targetLanguage');
      model.set('languages', languages);
      model.set('sourceLanguage', sl ? sl : 'en');
      model.set('targetLanguage', tl ? tl : 'ko');
    });

    var ilurl = sprintf('/api/v1.3/languages?locale=%s&field=intermediate&sortby=-1', locale);
    $.get(ilurl, function(response) {
      var languages = $.map(response.languages, function(pair) {
        return {label: pair[1], value: pair[0]};
      });
      var il = $.cookie('intermediateLanguage');
      model.set('intermediateLanguages', languages);
      model.set('intermediateLanguage', il ? il : 'ja');
    });

    // Initialize tooltips
    $("button[data-toggle=tooltip]").tooltip();
};

window.onpopstate = function(event) {
    if (event.state != null) {
        state.initWithState(event.state);
    }
};
</script>
{% endblock %}
